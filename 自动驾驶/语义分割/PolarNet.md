# 一、前言

## 1、相关概念

1. **激光雷达细粒度语义分割：**与图像语义分割类似，任务是为给定输入点云的每个点分配一个语义标签。

2. [**perception field 感受野**](https://blog.csdn.net/BigData_Mining/article/details/104418748/)：卷积神经网络每一层输出的特征图上的像素点在输入图片上映射的区域大小。通俗来说就是特征图上的一个点对应输入图上的区域。如图所示![在这里插入图片描述](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0RhdGFfTWluaW5n,size_16,color_FFFFFF,t_70.png)

3. **BEV： **bird's-eye-view

4. **mIoU：** mean intersection-over-union 

5. PointNet： **非参数化处理方法**。用于处理激光雷达扫描点云数据，分别处理每个点，然后使用集合函数聚合这些点的上下文信息。

6. **[语义分割](https://blog.csdn.net/weixin_61995249/article/details/124066133)：**将一些原始数据（例如平面图像）作为输入并将它们转换为具有突出显示的感兴趣区域的掩膜。通俗来说，就是把每个像素点进行分类，如图所示。<img src="https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221219220456977.png" alt="image-20221219220456977" style="zoom:67%;" /><img src="https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5L2V5Ly85Zyo5Lq66Ze05ZGQ,size_18,color_FFFFFF,t_70,g_se,x_16.png" alt="在这里插入图片描述" style="zoom:67%;" />

7. **体素：** *体素*(*voxel*)是像素(pixel)、体积(volume)和元素(element)的组合词,相当于3D空间中的像素。

   [激光雷达中的体素](https://blog.csdn.net/weixin_43390001/article/details/106173986)： 激光雷达返回的数据是点云格式，需要预先确定体素的大小，人工对点云区域进行分割，将点云格式转为体素格式。有的体素可能包含多一些激光点，有些体素包含少一些激光点。



## 2、研究意义

目前单扫描激光雷达在线语义分割的研究仍然具有挑战性：

1. 在有限的硬件下需要接近实时的延迟
2. 激光雷达点在空间上分布不均匀甚至长尾
3. 细粒度语义类越来越多

语义信息的作用：查到的一个作用是提高激光雷达slam的性能

## 3、研究内容

​	提出一种新的单扫描激光雷达在线语义分割算法：PolarNet。用**极化鸟瞰图（极坐标系）**平衡网格单元间地点，间接地将==分割网络的注意力==与沿==径向轴==的==点长尾分布==对齐。

​		使用端到端神经网络进行激光雷达点云的单扫描语义分割。在此之前，先要**构建一个激光雷达点云扫描的良好输入表示**。

​		类比图像中的相关问题。在图像分割中，感受野是设计高性能CNN时最原则性的考虑因素之一。它决定了神经网络在将像素分类为语义类之前可以“感知”多少上下文。一般来说，放大感受野可以提高性能，常用的技术有扩张卷积、特征金字塔。

​		回到激光雷达点云，作者猜想不仅感受野的大小重要，感受野的形状也很重要。如图Figure 3（a），以鸟瞰图视角观察，使用规则笛卡尔坐标会以不均匀的方式将点分布在网格单元中。靠近传感器的单元必须在每个单元上压缩许多点，从而模糊了这些点的细节。远离传感器的单元包含的点非常稀疏，利用神经网络标记这些点时能参考的线索非常有限。![image-20221209104452770](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221209104452770.png)

​		因此，作者提出将LiDAR扫描分割为**极坐标网络**，让CNN感受野跟踪特殊的环形结构。

​		与现有的BEV相关研究的相比，主要从两个方面提升了普通BEV表示：（1）在激光雷达扫描中追踪环形结构的极坐标网格。（2）使用神经网络学习每个网格单元的局部特征而不是手工制作（存在其他论文也使用了极坐标网格，但每个网格单元的特征使用手工制作的方法得到）。

​		产生的问题：因为图像和特征矩阵本质上是在笛卡尔坐标系中的，极坐标在CNN中很少见。

​		为了将极坐标化BEV表示与二维CNN完全集成。**第一**，作者根据Figure 3（b）所示的==自顶向下==极坐标来分配点。如 Figure 4所示，采用极坐标BEV显著平衡了每个网格的点，使其更加接近一个数量级。**第二**，学习了一个简化的PointNet（注：此PointNet不是语义分割网络PointNet），将每个网格中的点转换为固定长度的表示向量。**第三**，为了确保下游CNN中感受野的一致性，作者将这些特征向量排列成极坐标网格，==其最左侧和最右侧的列是相连的==。**第四**，作者修改了下游CNN，使其能够在极坐标网格上连续卷积，在获得离散预测（也是极坐标网格）后，将其映射回笛卡尔空间中的点并评估性能。工作流程如Figure 2所示。![image-20221209131526743](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221209131526743.png)![image-20221209132743707](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221209132743707.png)

​		PolarNet通过方法基于Unet进行修改。在Unet（该网络添加了跳过连接skip connections 用来直接连接不同级别的语义特征）修改输入表达和卷积方法。

## 4、贡献

1. 提出了一种更适合LiDAR扫描的表示，它考虑了点的不平衡空间分布。
2. 如Figure 1 所示。作者提出的PolarNet网络，使用他们的极**坐标网格数据表示**进行端到端训练，超过了公共基准的最先进方法，计算成本低。![image-20221209133745728](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221209133745728.png)
3. 分别使用其他表示（如笛卡尔BEV）和极坐标网格表示，对基于不同==主干分割网络==的语义分割性能进行了全面分析。

## 5、研究结论

该编码方案在保持接近事实吞吐量的同时，极大地提高了真实城市激光雷达单次扫描的三个不同的分割数据集的mIoU

# 二、方法

## 1、问题称述

给定 N 次 LiDAR 扫描的训练数据集 {(P~i~, L~i~)|i = 1,…,N}, P~i~ ∈ R^n~i~×4^ 是包含 n~i~ 个 LiDAR 点的第 i 个点集。 P~i~的每一行由代表一个LiDAR点p的四个特征组成，即（x，y，z，reflection）。 (x, y, z) 是该点相对于扫描仪的笛卡尔坐标。 reflection是返回激光束的强度。 L~i~ ∈ Z^ni^ 包含 P~i~ 中每个点 p~j~ 的对象标签。

我们的目标是学习一个由 θ 参数化的分割模型 f(·; θ)，以使预测 f(Pi) 和 Li 之间的差异最小化。

## 2、鸟瞰图分区

​		点云扫描由周围3D扫描的分散观察组成，但我们根据经验，我们可以把3D点云图表示为==具有最小信息损失的场景==的自上而下的快照（snapshot）。先前的论文提出将鸟瞰图这种自上而下的投影直接输入到2D检测网络中以**检测3D点云中的对象**。随后这种方法被用于点云分割，通过将2D图像自顶向下图像作为输入，网络输入具有相同维度形状的张量，==每个空间位置沿着该位置的z轴对每个体素的类别预测进行编码==。这种优雅的方法利用了2D神经网络多年的研究成果，加快了分割过程。还避免了昂贵的3D分割和3D图形操作。

​		BEV的动机：用自上而下的图像表示场景，加快下游特定任务的CNN。BEV表示与自然图像的外观非常相似，因此可以最大限度地利用下游地CNN。

​		网格是基本的图像表示，但它可能不是BEV的最佳表示。BEV是性能和精度之间的折中。观察BEV图像可以注意到，点密集地分布在中间网格单元中，外围网格单元完全是空的。这种不均匀的划分不仅**浪费计算能力**，而且**限制了中心网格单元的特征表示**。此外，不同标签的点可能会被分配给单个单元格，由于最终的预测是体素级的，因此在输出中，数量少的点的预测会被数量多的点抑制。

## 3、极坐标鸟瞰图

​		如何解决上述不平衡？用极化划分代替了笛卡尔划分。作者首先以传感器的位置为远点计算XY平面上每个点的方位角和半径。然后根据量化的方位角和半径为网格单元分配点。

​		极化BEV的好处由两个。

1. 更平均的分配数据。如图四所示。
2. 更平衡的点分布减轻了预测器的负担。使用笛卡尔BEV，每个网格单元平均由98.75%的点共享相同的标签。在极化BEV中，上升到了99.3%。==这表明，由于空间表示，极化BEV中的点较少受到误分类的影响。==小物体更可能被体素中的大多数标签淹没，0.6%的差异可能会对最终的mIoU产生更深远的影响。为了进一步研究mIoU上界，我们将每个点的预测设置为其指定体素的多数标记。结果表明，在==健全性检查==中，笛卡尔BEV的mIoU达到97.3%，极化BEV达到98.5%。极化BEV中较高的上线可能会提高下游模型的性能。

## 4、学习极化网格

​		用固定长度表示（representation）来捕捉每个网格中的点分布，而不是为每个网格手工制作特征。它有一个可学习的简化PointNet （用h表示）接着一个最大池产生。

​		网络包含全连接层（fully-connected layers）、批处理规范化层（batch-normalization layers）和ReLu 层。

​		如图二所示，如果在极坐标系中学习表示，则特征矩阵的两侧将沿物理空间的方向轴连接起来。作者开发了一个**环卷积**（离散卷积），环卷积将卷积矩阵，并且该矩阵被认为在半径轴两端连接。同时，==位于相反一侧的梯度可以通过这个环形卷积核传播回另一侧==。通过用2D网络中的环形卷积代替常规卷积，网络能够端到端地处理极坐标网格，而不会忽略其连接性。==这为模型提供了更大的感受野==。由于它是一个2D神经网络，最终的预测也将是一个极坐标网格，==其特征维数等于量化高度通道和类数的乘积。然后，我们可以将预测重塑为4D矩阵，以导出基于体素的分割损失。==

# 三、实验

介绍实验设置、结果和消融实验。

## 1、数据集

1. SemanticKITTI

   KITTI数据集中激光雷达部分的点云层面的重新注释（point-level re-annotation）

2. A2D2

   如Figure 5 （b）所示，尽管A2D2数据在空间中以3D点的形式呈现，但这些点的分布与KITTI对应点不同：

   首先，KITTI数据集是用单个传感器创建全景激光雷达扫描。而A2D2使用了五个异步LiDAR传感器，每个传感器覆盖周围试图的一部分。==因此==，几乎所有A2D2重建的LiDAR视图都不覆盖所有角度。

   其次，A2D2 LiDAR传感器不一定产生水平扫描线。

3. Paris-Lille-3D

   与其他两个数据集相比，该数据集提供了三个聚集点云，这些点云是由一个安装在后部的Velodyne HDL-32E雷达收集的连续激光雷达扫描（场景为巴黎和里尔的街道）。每个点使用九个分割类中一个、时间戳和世界坐标进行标注。给定扫描仪轨迹和点的时间戳，我们从注册的点云中提取单个扫描。我们每50毫秒记录一次扫描，==每次扫描由+/-100ms内的点进行==

![image-20221210165334072](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221210165334072.png)

==数据集验证测试集分割==

## 	2、基准线

1. SqueezeSeg：

   将LiDAR点投影到传感器周围的球面上，将问题转化为2D分割问题。

   - Darknet-53：

     将SqueezeNetNet的主干网络（backbone）替换成YOLO。

   - RangeNet++：

     加入了一种基于KNN的后处理方法，该方法在CNN分割网络之后使用，可以减少球面中间表示的离散化所产生的误差。

2. PointNet:

   **基于点的方法；**

   先通过完全连接的网络单独处理每个点。然后最大池化所有点的特征来总结全局表示。预测器根据每个点的特征和全局表示来预测每个点类。

   - PointNet++

   是通过向普通PointNet添加分层池和上下文表示而获得的经验改进。

3. TangentConv：

   **基于点的方法；**

   使用曲面几何上的切线卷积来预测3D点云的分割类别。

4. RandLA：

   用局部特征聚合模块分割大规模点云。

## 3、评价指标

- per-class IoU

- mIoU

- 模型单次扫描预测延迟

- 每秒最大帧数（FPS）：使用尽可能最大的batch size时，每秒最大帧数

- 平均每次扫描的乘加操作（MAC）

- 模型的参数数量

## 4、SemanticKITTI语义分割实验

![image-20221211101916500](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221211101916500.png)

结论：作者使用的**基于Unet的极坐标鸟瞰图分割网络（PolarNet）**在参数数量较少和延迟较低的情况下仍优于现有技术方法。

- 基于点的方法（比如PointNet和TangentConv），当使用在大型LiDAR点云中时，效率低，分割精度差。
- 对于每个类的IoU，作者提出的BEV方法在大多数类中实现了改进，特别是在哪些不规则且空间中稀疏分布的类，==这与极化BEV尺度和范围保存特性相匹配==。

## 5、A2D2 语义分割实验

![image-20221211105601604](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221211105601604.png)

结论：作者的方法在mIoU和==速度==上都要优于其他基准线（baseline）。

从mIoU可以看出，该数据集是一个非常具有挑战性的数据集。虽然PolarNet是领先的方法，但也只达到了23.9%，而在semanticKITTI中可以达到54.3%

## 6、Paris-Lille-3D 语义分割

![image-20221211112624177](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221211112624177.png)

结论：PolarNet方法在mIoU方面优于DarkNet53 3.7%，同时大大提高了对于障碍物的效果。原因是障碍物大多远离车辆。然后笛卡尔Unet在垃圾桶方面具有很大的优势，==因为==训练和验证集只有很少的垃圾桶样本。

## 7、投影方法的影响

![image-20221211125818450](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221211125818450.png)

在SemanticKITTI中使用三种不同的投影方法：SqueezeSeg中提出的球面投影、笛卡尔BEV和作者提出的极性BEV（PolarNet）

四种不同的主干网络：SqueezeSeg、Resnet-FNC、DRN-DL、Resent-DL

结果表明：无论使用何种分割网络，BEV方法总是显著优于球面投影方法。同时，实验还表明极化BEV比笛卡尔BEV具有更好的表现。

## 8、消融实验

![image-20221211132418280](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221211132418280.png)

不同训练设置对mIoU结果的影响

基线是极性BEV Unet网络，使用的网格大小为[256, 256, 32]

- RC：表示主干网络中使用环形卷积核而不是普通的2D卷积
- 9F：用九个特征来描述一个点，包括2个笛卡尔坐标、距离指定网格中心的3个残差距离、1个反射、3个极坐标
- FA：分别沿x、y、x+y轴按照25%的概率随机翻转点云进行数据扩充
- FS：根据前面提到的统计分析确定BEV的体积空间。
- TG：表示在尝试不同的网格大小配置以达到最佳性能后，将网格大小调整为[480、360、32]

从表五可以看出，固定体积空间（FS）提高了2.8%的mIoU，这是最显著的改进。

## 9、点与传感器距离对mIoU造成的影响

![image-20221211205302894](https://raw.githubusercontent.com/letMeEmoForAWhile/typoraImage/main/img/image-20221211205302894.png)

结论1：随着距离的增加，mIoU减少。原因是较远距离的点在空间山更加稀少和分离，这使得分割网络更难从BEV表达中提取上下文信息。

结论2：如图4所示，由于极化BEV表示中点分布更均匀，因此在近距离内极性BEV总体上比笛卡尔BEV获得更高的mIoU。而大多数点恰好是离传感器比较近的。

# 四、全文总结

在本文中，我们提出了一种新的数据表示方法，用于在线单扫描激光雷达点云语义分割问题。

我们的方法通过将点量化到极地鸟瞰(BEV)网格来解决激光雷达点云的长尾空间分布问题，在那里我们通过可训练的点网将点编码为固定大小的表示形式。

基于极性网格表示，我们的PolarNet网络在SemanticKITTI、A2D2和Paris-Lille-3D数据集上的mIoU比最先进的方法有了显著的改进，参数更少，吞吐量更高，推理延迟更低。此外，我们的实验表明，与球面投影和笛卡尔BEV相比，使用我们的极坐标BEV在不同的分割网络中普遍具有改进，这表明我们的极坐标网格是一种优秀而通用的激光雷达点云数据表示，用于在线语义分割问题。

