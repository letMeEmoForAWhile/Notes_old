# 名词解释

**EMI**（Equivalence Modulo Inputs）：等效模输入，给拥有一些输入的一个测试程序，EMI对程序进行变异，派生出在输入相同时语义等价的变体。

**MCMC**（Markov Chain Monte Carlo）：马尔科夫链蒙特卡洛方法

**控制流图**（Control Flow Graph，CFG）：是用在**编译器**中的一个**抽象数据结构**，由编译器在内部维护，代表了一个程序执行过程中会遍历到的所有路径。它用图的形式表示一个过程内所有基本块执行的可能流向，也能反映一个过程的实时执行过程。

**AST：**抽象语法树

# 概述

**目标：**增加原始用例的控制流和数据流的多样性，提高发现编译优化器漏洞的概率

**算法：**马尔科夫链蒙特卡洛算法

**主要贡献：**

1. 实现了一种通过在**未执行代码块**插入语句获取等效测试用例的方法。
2. 通过==MCMC采样==指导变异因子的获取，获得更加**多样**的变异体，提高了发现编译器更深层bug的效率。
3. 进一步证明了EMI测试方法的有效性，在GCC和LLVM编译器上共发现了72个新型bug，其中17个bug的级别为P1

# 理论准备

1 ==定义 Program Distance==

原始用例与变异后用例的三个方面：1 控制流图的节点距离 2 控制流图的边距离 3 控制流图的大小差别

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20211019164046626.png" alt="image-20211019164046626" style="zoom:67%;" />

2 ==MCMC采样==

使用马尔科夫链在空间X画样本X~i~

3 变异因子获取

4 ==Variant Proposal==

1. 提取变异因子
2. 生成新的变异体
3. 保持遍历性。 必须要满足任一一个状态可以转变到任意其他状态。Q*->Q

# 问题

1 如何保证用例语义的连贯性

​		获取变异因子时，同时存储语句的上下文（context），一起存到数据库中。插入时保证与插入位置的上下文匹配。

2 如何使插入更有可能触发bug的代码。

​		program distance越大越好，变异用例多样性。

# # 测试软件框架

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20211019221849523.png" alt="image-20211019221849523"  />

- seed program：种子程序，即未变异的程序

- existing program：代码语料库中的程序

同时从种子程序和代码语料库中的程序中提取**候选语句**。再利用候选语句对种子程序进行MCMC采样，得到变异程序，从而发现bug。

# # 软件设计

## ## 获取变异因子

从代码语料库种提取。利用**stmt-extractor**遍历LLVM的libtools库。stmt-extractor会访问程序AST的所有**语句**，然后确定应用这些**语句**所需的上下文（context），并以<context,statement>对的形式存入数据库。

content：包含以下信息

- 在语句中使用但在外部定义的变量及其类型
- 语句中使用的函数及其签名
- 语句中定义的标签
- 语句中使用的标签
- 一个flag标志，标记是否使用了break或者continue

# # 举例



